<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Login | Blood Bank+</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>

  <!-- NAVBAR -->
  <header class="navbar">
    <div style="display:flex;align-items:center;gap:10px;">
      <img src="img/logo.png" alt="Blood Bank Logo"
           style="height:40px;width:auto;border-radius:8px;" />
      <span style="font-weight:700;font-size:20px;">Blood Bank+</span>
    </div>
    <nav>
      <a href="index.html">Home</a>
      <a href="donor-register.html">Become a Donor</a>
      <a href="request-blood.html">Request Blood</a>
      <a href="login.html">Admin Login</a>
    </nav>
  </header>

  <main style="min-height:100vh;display:flex;align-items:center;justify-content:center;">
    <div class="glass-card" style="max-width:380px;width:100%;margin-top:60px;">
      <h2 style="text-align:center;margin-bottom:6px;">Admin Login</h2>
      <p style="text-align:center;font-size:14px;opacity:0.8;margin-bottom:18px;">
        Restricted area for authorized blood bank staff.
      </p>

      <form id="loginForm">
        <div class="form-group">
          <input class="form-input" type="email" id="email" name="email"
                 placeholder=" " required />
          <label class="form-label" for="email">Email</label>
        </div>

        <div class="form-group">
          <input class="form-input" type="password" id="password" name="password"
                 placeholder=" " required />
          <label class="form-label" for="password">Password</label>
        </div>

        <button class="btn btn-primary" type="submit" style="width:100%;margin-top:4px;">
          Login
        </button>

        <p style="font-size:12px;opacity:0.7;margin-top:8px;">
          Demo credentials: admin@bloodbank.com / admin123
        </p>
        <p id="loginMessage" style="margin-top:10px;font-size:14px;"></p>
      </form>
    </div>
  </main>

  <script>
    // Detect if running locally or in production
    const getAPIURL = () => {
      const protocol = window.location.protocol;
      const hostname = window.location.hostname;
      const port = window.location.port;
      
      // If running on localhost, use port 8087
      if (hostname === 'localhost' || hostname === '127.0.0.1') {
        return `${protocol}//${hostname}:8087`;
      }
      // If running on a domain/IP, replace the frontend port with backend port
      if (port === '8086') {
        return `${protocol}//${hostname}:8087`;
      }
      // Default: use same host with backend port
      return `${protocol}//${hostname}:8087`;
    };
    const API_URL = getAPIURL();
    const loginForm = document.getElementById("loginForm");
    const loginMessage = document.getElementById("loginMessage");

    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      loginMessage.textContent = "Authenticating...";
      loginMessage.style.color = "#cccccc";

      const payload = Object.fromEntries(new FormData(loginForm).entries());
      try {
        const res = await fetch(API_URL + "/api/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const data = await res.json();
        
        if (!res.ok) {
          loginMessage.textContent = data.error || "Invalid email or password.";
          loginMessage.style.color = "#ff5f77";
          console.error("Login error:", data);
          return;
        }

        localStorage.setItem("bb_token", data.token);
        localStorage.setItem("bb_user", JSON.stringify(data.user));

        loginMessage.textContent = "Login successful. Redirecting...";
        loginMessage.style.color = "#4eff7b";

        setTimeout(() => {
          window.location.href = "admin-dashboard.html";
        }, 700);
      } catch (err) {
        console.error(err);
        loginMessage.textContent = "Network error: " + err.message;
        loginMessage.style.color = "#ff5f77";
      }
    });
  </script>
</body>
</html>
